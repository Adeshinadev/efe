{% extends "base.html" %}
{% load static %}

{% block title %}EFE â€“ Shop{% endblock %}

{% block head_extra %}
  <style>
    /* Match index.html product card styles */
    html, body { overflow-x: hidden; }
    .container, .row, .shop-grid, .food-box, .thumb, .desc { max-width: 100%; }
    .shop-grid .shop-box { display:flex; flex-direction:column; height:100%; }
    .shop-grid .thumb { height:340px; position: relative; overflow: hidden; }
    .shop-grid .thumb img { width:100%; height:100%; object-fit:cover; display:block; }
    .shop-grid .desc { padding-top: 15px; margin-top:auto; }
    @media (min-width: 768px) { .shop-grid .thumb { height:360px; } }
    @media (min-width: 992px) { .shop-grid .thumb { height:420px; } }

    .clickable-card { cursor: pointer; }

    .shop-search-inline { margin-bottom: 1rem; }
    .shop-search-inline .input-group {
      display: flex;
      flex-wrap: nowrap;
      align-items: stretch;
      width: 100%;
    }
    .shop-search-inline .input-group .form-control {
      flex: 1 1 auto;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
    .shop-search-inline .input-group-append {
      display: flex;
      flex: 0 0 auto;
    }
    .shop-search-inline .input-group-append .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      height: auto;
      padding-left: 14px;
      padding-right: 14px;
    }

    .product-grid-row {
      margin-left: -15px;
      margin-right: -15px;
    }
    .product-grid-row > [class*="col-"] {
      padding-left: 15px;
      padding-right: 15px;
    }

    /* Mobile grid layout */
    @media (max-width: 575.98px) {
      html, body { overflow-x: hidden; }
      .Shop-section .container { padding-left: 8px; padding-right: 8px; }
      .shop-products-wrapper { overflow: hidden; }
      .product-grid-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        margin: 0;
        gap: 8px;
        width: 100%;
      }
      .product-grid-row > [class*="col-"] {
        padding: 0;
        flex: 0 0 calc((100% - 8px) / 2);
        max-width: calc((100% - 8px) / 2);
        margin-bottom: 10px;
      }
      .shop-grid .thumb { height: 190px; }
      .shop-grid .desc { padding-top: 6px; }
      .shop-grid .desc h4, .shop-grid h4 {
        font-size: 0.9rem;
        line-height: 1.2;
        margin-bottom: 6px;
      }
      .shop-grid .desc h4 a {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .food-box.shop-box {
        max-width: none;
        width: 100%;
        border-radius: 8px;
      }
      .shop-search-inline .input-group,
      .shop-search-inline .form-control {
        width: 100%;
      }
    }
  </style>
{% endblock %}

{% block content %}

  <!--====== BREADCRUMB ======-->
  <section class="breadcrumb-area" style="background-image: url({% static 'assets/img/bg/04.jpg' %});">
    <div class="container">
      <div class="breadcrumb-text">
        <span>DE ELEGANT EXPERTISE PALAIS</span>
        <h2 class="page-title">Shop</h2>
      </div>
    </div>
  </section>

  <!--====== SHOP SECTION ======-->
  <section class="Shop-section pt-120 pb-120">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="shop-products-wrapper">
            <!-- TOP SEARCH -->
            <form action="{% url 'shop' %}" method="get" class="shop-search-inline">
              <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search products..." value="{{ search_query|default:'' }}">
                <div class="input-group-append">
                  <button class="btn btn-dark" type="submit"><i class="far fa-search"></i></button>
                </div>
              </div>
            </form>

            <div class="product-wrapper restaurant-tab-area shop-grid">
              <div class="row product-grid-row justify-content-sm-start">
                {% for cloth in shop %}
                <div class="col-6 col-sm-6 col-md-4 col-lg-3 mb-4 d-flex">
                  <div class="food-box shop-box h-100 clickable-card"
                       data-wa="https://wa.me/2348160089184?text={{ 'Hi, I am interested in ' | add:cloth.name | urlencode }}">
                    <div class="thumb">
                      <img src="{{ cloth.image.url }}" alt="{{ cloth.name }}">
                      <div class="button-group">
                        <a href="#" class="js-stop"><i class="far fa-heart"></i></a>
                        <a href="#" class="js-stop"><i class="far fa-sync-alt"></i></a>
                        <a href="#" class="js-stop" data-toggle="modal" data-target="#quickViewModal"><i class="far fa-eye"></i></a>
                      </div>
                    </div>
                    <div class="desc mt-auto">
                      <h4>
                        <a title="{{ cloth.name }}" href="https://wa.me/2348160089184?text={{ 'Hi, I am interested in ' | add:cloth.name | urlencode }}">
                          {{ cloth.name|truncatewords:3 }}
                        </a>
                      </h4>
                      <a href="https://wa.me/2348160089184?text={{ 'Hi, I am interested in ' | add:cloth.name | urlencode }}" class="link"><i class="fal fa-arrow-right"></i></a>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>

          {% if shop.paginator.num_pages > 1 %}
          <div class="pagination-wrap">
            <ul>
              {% if shop.has_previous %}
              <li><a href="?page={{ shop.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"><i class="far fa-angle-double-left"></i></a></li>
              {% endif %}

              {% for num in shop.paginator.page_range %}
                {% if shop.number == num %}
                  <li class="active"><a href="#">{{ num }}</a></li>
                {% else %}
                  <li><a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}">{{ num }}</a></li>
                {% endif %}
              {% endfor %}

              {% if shop.has_next %}
              <li><a href="?page={{ shop.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}"><i class="far fa-angle-double-right"></i></a></li>
              {% endif %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </section>

{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.clickable-card').forEach(function(card){
      const url = card.getAttribute('data-wa');
      card.addEventListener('click', function(e){
        if (e.target.closest('.js-stop') || e.target.closest('a')) return;
        window.open(url, '_blank');
      });
    });
  });
</script>
{% endblock %}